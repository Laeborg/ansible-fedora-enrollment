---
- name: Ensure sudoers.d directory exists
  ansible.builtin.file:
    path: /etc/sudoers.d
    state: directory
    mode: '0750'
  become: true

- name: Configure sudo for Azure Entra ID admin group
  ansible.builtin.copy:
    content: |
      # Allow Azure Entra ID admin group members to use sudo
      %G_HIMMELBLAU ALL=(ALL) ALL
    dest: /etc/sudoers.d/himmelblau-admins
    mode: '0440'
    validate: 'visudo -cf %s'
  become: true
