---
# Remove iBus on COSMIC desktop
# iBus causes notification errors on COSMIC Wayland at every login
# Not needed for Danish/English keyboards - only required for complex input (Chinese, Japanese, etc.)
- name: Remove iBus and all dependent packages on Fedora COSMIC systems
  ansible.builtin.dnf:
    name: ibus
    state: absent
    allowerasing: true
  become: true
  when: ansible_distribution == "Fedora"

# Automatic Security Updates
- name: Install dnf-automatic for automatic updates
  ansible.builtin.dnf:
    name: dnf-automatic
    state: present
  become: true
  when: ansible_distribution == "Fedora"

- name: Configure dnf-automatic for security updates only
  community.general.ini_file:
    path: /etc/dnf/automatic.conf
    section: commands
    option: upgrade_type
    value: security
    create: true
    mode: '0644'
  become: true
  when: ansible_distribution == "Fedora"

- name: Configure dnf-automatic to apply updates automatically
  community.general.ini_file:
    path: /etc/dnf/automatic.conf
    section: commands
    option: apply_updates
    value: "yes"
    create: true
    mode: '0644'
  become: true
  when: ansible_distribution == "Fedora"

- name: Configure dnf-automatic download updates
  community.general.ini_file:
    path: /etc/dnf/automatic.conf
    section: commands
    option: download_updates
    value: "yes"
    create: true
    mode: '0644'
  become: true
  when: ansible_distribution == "Fedora"

- name: Enable and start dnf-automatic timer for daily security updates
  ansible.builtin.systemd:
    name: dnf-automatic-install.timer
    enabled: true
    state: started
  become: true
  when: ansible_distribution == "Fedora"
